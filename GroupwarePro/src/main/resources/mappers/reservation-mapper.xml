<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="reservationMapper">
	<!-- resultMap -->

	<resultMap id="reservationResultSet" type="Reservation">
		<id column="REZ_NO" property="rezNo" />
		<result column="NAME" property="name" />
		<result column="START_DATE" property="startDate" />
		<result column="END_DATE" property="endDate" />
		<result column="AS_NO" property="asNo" />
		<result column="EMP_NO" property="empNo" />
		<result column="EVT_NO" property="evtNo" />
		
	</resultMap>

	<resultMap id="assetResultSet" type="Asset">
		<id column="AS_NO" property="asNo" />
		<result column="NAME" property="name" />
		<result column="COLOR" property="color" />
	</resultMap>

	<!-- READ -->
	<select id="selectReservationList" parameterType="_int" resultMap="reservationResultSet">

		SELECT * 
		FROM RESERVATION2 
		WHERE EMP_NO = #{empNo} AND IS_DELETE = 'N'

	</select>

	<select id="selectAssetList" resultMap="assetResultSet">
	
		SELECT * 
		FROM ASSET2 
		WHERE IS_DELETE = 'N'
	
	</select>

	<!-- CREATE -->
	
	<insert id="insertReservation" parameterType="Reservation">
	
		<selectKey keyProperty="rezNo" resultType="int" order="BEFORE">
			SELECT SEQ_REZ_ID.NEXTVAL FROM DUAL
		</selectKey>
	
		INSERT INTO RESERVATION2 
		VALUES (#{rezNo}, #{name}, #{startDate}, #{endDate}, DEFAULT, #{asNo}, #{empNo}, #{evtNo})
		
	</insert>
	
	<insert id="insertAsset" parameterType="Asset">
	
		<selectKey keyProperty="asNo" resultType="int" order="BEFORE">
			SELECT SEQ_AS_ID.NEXTVAL FROM DUAL
		</selectKey>
	
		INSERT INTO ASSET2 
		VALUES (#{asNo}, #{name}, #{color}, DEFAULT)
	
	</insert>
	

	<!-- UPDATE -->

	<update id="updateAsset" parameterType="Asset">
	
		UPDATE ASSET2
		<trim prefix="SET" suffixOverrides=",">		
			<if test="name != null">
				NAME = #{name},
			</if>
			<if test="color != null">
				COLOR = #{color},
			</if>
		</trim>
		WHERE AS_NO = #{asNo} AND IS_DELETE = 'N'
	
	</update>

	
	<update id="updateReservation" parameterType="Reservation">
	
		UPDATE RESERVATION2 
		<trim prefix="SET" suffixOverrides=",">		
			<if test="name != null">
				NAME = #{name},
			</if>
			<if test="startDate != null">
				START_DATE = #{startDate},
			</if>
			<if test="endDate != null">
				END_DATE = #{endDate},
			</if>
		</trim>
		WHERE REZ_NO = #{rezNo} AND IS_DELETE = 'N'
		
	</update>

	<!-- DELETE -->
	<update id="deleteReservation" parameterType="_int">
		
		UPDATE RESERVATION2 SET ISDELETE = 'Y' WHERE REZ_NO = #{rezNo}
		
	</update>

	<update id="deleteAsset" parameterType="_int">
		
		UPDATE ASSET2 SET ISDELETE = 'Y' WHERE AS_NO = #{asNo}
		
	</update>

</mapper>